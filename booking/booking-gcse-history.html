<!DOCTYPE html>
<html lang="en-GB">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Book Your Session | Yuli</title>

  <!-- Icons & Fonts -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&family=Montserrat:wght@600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --yuli-primary:#4361EE;
      --yuli-navy:#1e293b;
      --yuli-dark-blue:#334155;
      --yuli-light-blue:#e0f2fe;
      --yuli-accent-blue:#0ea5e9;
      --text-dark:#1f2937;
      --text-muted:#64748b;
      --text-light:#ffffff;
      --bg-navy:#0f172a;
      --bg-blue-tint:#f1f8ff;
      --card-bg:#ffffff;
      --border-light:#e5e7eb;
      --border-blue:#bfdbfe;
      --shadow-soft:0 4px 6px -1px rgba(30,41,59,.1),0 2px 4px -1px rgba(30,41,59,.06);
      --shadow-medium:0 10px 15px -3px rgba(30,41,59,.1),0 4px 6px -2px rgba(30,41,59,.05);
      --shadow-blue:0 10px 25px -5px rgba(67,97,238,.2);
      --success:#16a34a;
      --error:#dc2626;
      --header-height:66px;
    }

    *{margin:0;padding:0;box-sizing:border-box;}

    body{
      font-family:'Poppins',sans-serif;
      line-height:1.6;
      color:var(--text-dark);
      background:var(--bg-blue-tint);
      min-height:100vh;
    }

    /* Header */
    .site-header{
      height:var(--header-height);
      min-height:var(--header-height);
      box-sizing:border-box;
      padding:0 24px;
      display:flex;
      align-items:center;
      background:var(--card-bg);
      border-bottom:1px solid var(--border-light);
      position:sticky;top:0;z-index:100;
    }
    .site-header *{margin:0;}

    .header-container{
      max-width:1200px;width:100%;margin:0 auto;
      display:flex;justify-content:space-between;align-items:center;height:100%;
    }

    /* Match homepage logo exactly */
    .logo{
      font-size:24px;
      font-weight:700;
      color:#4361EE;
      text-decoration:none;
      z-index:10;
      flex-shrink:0;
      font-family:'Poppins',system-ui,-apple-system,'Segoe UI',Roboto,sans-serif;
    }
    .logo span{color:#ff69b4;}

    .back-button{
      color:var(--text-muted);
      text-decoration:none;
      font-size:.95rem;
      display:flex;align-items:center;gap:.5rem;
      padding:.5rem 1rem;border-radius:8px;transition:all .2s ease;
    }
    .back-button:hover{color:var(--yuli-primary);background:var(--yuli-light-blue);}

    /* Layout */
    .main-container{
      max-width:1200px;margin:0 auto;padding:3rem 2rem;
      display:grid;grid-template-columns:1fr 1fr;gap:4rem;align-items:start;
    }

    /* Left column */
    .hero-section{padding:2rem 0;}
    .hero-content h1{
      font-family:'Montserrat',sans-serif;font-size:2.5rem;font-weight:700;
      color:var(--text-dark);margin-bottom:1rem;line-height:1.2;
    }
    .subject-badge{
      display:inline-block;background:var(--yuli-primary);color:#fff;
      padding:.5rem 1rem;border-radius:50px;font-size:.9rem;font-weight:600;
      margin-bottom:1.5rem;box-shadow:var(--shadow-soft);
    }
    .hero-description{font-size:1.1rem;color:var(--text-muted);margin-bottom:2rem;line-height:1.7;}

    .what-happens-next{
      background:var(--card-bg);border-radius:16px;padding:2rem;margin-bottom:2rem;
      box-shadow:var(--shadow-soft);border:1px solid var(--border-light);
    }
    .section-title{
      font-family:'Montserrat',sans-serif;font-size:1.3rem;font-weight:600;
      color:var(--text-dark);margin-bottom:1.5rem;display:flex;align-items:center;gap:.75rem;
    }
    .section-title i{color:var(--yuli-primary);font-size:1.1rem;}
    .timeline-steps{margin-bottom:1.5rem;}
    .timeline-step{display:flex;align-items:flex-start;gap:1rem;margin-bottom:1.25rem;padding:.25rem 0;}
    .timeline-step:last-child{margin-bottom:0;}
    .timeline-icon{width:28px;height:28px;background:var(--yuli-light-blue);color:var(--yuli-primary);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:.75rem;flex-shrink:0;margin-top:.05rem;font-weight:500;}
    .timeline-content{flex:1;min-width:0;}
    .timeline-timing{font-weight:600;color:var(--text-dark);font-size:.9rem;margin-bottom:.3rem;line-height:1.3;}
    .timeline-description{color:var(--text-muted);font-size:.85rem;line-height:1.4;}

    .info-box{background:var(--bg-blue-tint);border-radius:12px;padding:1.25rem;margin-bottom:1.5rem;}
    .info-box:last-child{margin-bottom:0;}
    .info-box-title{font-weight:600;color:var(--text-dark);margin-bottom:.75rem;font-size:.95rem;display:flex;align-items:center;gap:.5rem;}
    .info-box-title i{color:var(--yuli-primary);font-size:.9rem;}
    .info-item{display:flex;align-items:flex-start;gap:.75rem;margin-bottom:.9rem;font-size:.85rem;line-height:1.5;}
    .info-item:last-child{margin-bottom:0;}
    .info-item-label{font-weight:500;color:var(--text-dark);min-width:85px;flex-shrink:0;}
    .info-item-value{color:var(--text-muted);line-height:1.5;flex:1;}

    .session-structure-item{display:flex;align-items:flex-start;gap:.75rem;margin-bottom:1rem;font-size:.85rem;line-height:1.5;}
    .session-structure-item:last-child{margin-bottom:0;}
    .session-timing{font-weight:500;color:var(--yuli-primary);min-width:110px;flex-shrink:0;}
    .session-description{color:var(--text-muted);line-height:1.5;flex:1;}

    .booking-illustration{text-align:center;margin:2rem 0;}
    .booking-illustration img{max-width:300px;width:100%;height:auto;filter:drop-shadow(0 8px 32px rgba(67,97,238,.1));}

    /* Right column */
    .booking-card{
      background:var(--card-bg);border-radius:24px;padding:2.5rem;
      box-shadow:var(--shadow-medium);border:1px solid var(--border-light);
      position:sticky;top:100px;
    }

    .booking-steps{margin-bottom:2rem;}
    .step{margin-bottom:1rem;border:1px solid var(--border-light);border-radius:12px;overflow:hidden;transition:all .3s ease;}
    .step-header{display:flex;align-items:center;justify-content:space-between;gap:.75rem;padding:1rem 1.5rem;cursor:pointer;background:var(--bg-blue-tint);transition:all .2s ease;}
    .step-header:hover{background:var(--yuli-light-blue);}
    .step-header.completed{background:var(--bg-blue-tint);color:var(--text-dark);}
    .step-header.completed:hover{background:var(--bg-blue-tint);opacity:.9;}
    .step-header-left{display:flex;align-items:center;gap:.75rem;}
    .step-number{width:32px;height:32px;background:var(--yuli-primary);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:.9rem;line-height:1;text-align:center;}
    .step-header.completed .step-number{background:var(--yuli-primary);color:#fff;}
    .step-title{font-weight:600;color:var(--text-dark);font-size:1.1rem;}
    .step-header.completed .step-title{color:var(--text-dark);}
    .step-summary{font-size:.9rem;color:var(--text-muted);margin-top:.25rem;}
    .step-header.completed .step-summary{color:var(--text-muted);}
    .step-icon{color:var(--text-muted);transition:transform .2s ease;}
    .step-header.completed .step-icon{color:var(--text-muted);}
    .step-content{padding:1.5rem;border-top:1px solid var(--border-light);}

    /* Form */
    .form-group{margin-bottom:1rem;}
    .form-label{display:block;margin-bottom:.5rem;font-weight:600;color:var(--text-dark);}
    .required{color:var(--error);}
    .form-input,.form-select{width:100%;padding:.75rem;border:1px solid var(--border-light);border-radius:8px;font-size:1rem;transition:border-color .2s ease;}
    .form-input:focus,.form-select:focus{outline:none;border-color:var(--yuli-primary);box-shadow:0 0 0 3px rgba(67,97,238,.1);}
    .form-select{background:#fff;appearance:none;
      background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
      background-position:right .5rem center;background-repeat:no-repeat;background-size:1.5em 1.5em;padding-right:2.5rem;}
    .continue-button{width:100%;background:var(--yuli-primary);color:#fff;border:none;padding:1rem;border-radius:12px;font-size:1rem;font-weight:600;cursor:pointer;transition:all .3s ease;margin-top:1rem;}
    .continue-button:hover:not(:disabled){transform:translateY(-2px);box-shadow:var(--shadow-blue);}
    .continue-button:disabled{opacity:.4;cursor:not-allowed;transform:none;background:var(--text-muted);}

    /* Calendar */
    .calendar-container{border:1px solid var(--border-light);border-radius:16px;overflow:hidden;background:#fff;margin-bottom:1rem;}
    .calendar-header{background:var(--yuli-primary);color:#fff;padding:1rem;display:flex;justify-content:space-between;align-items:center;}
    .calendar-nav{background:none;border:none;color:#fff;font-size:1.2rem;cursor:pointer;padding:.5rem;border-radius:8px;transition:background .2s ease;}
    .calendar-nav:hover{background:rgba(255,255,255,.1);}
    .calendar-nav:disabled{opacity:.5;cursor:not-allowed;}
    .calendar-month{font-weight:600;font-size:1.1rem;}
    .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);}
    .calendar-day-header{padding:.75rem;text-align:center;font-size:.8rem;font-weight:600;color:var(--text-muted);background:var(--bg-blue-tint);border-bottom:1px solid var(--border-light);}
    .calendar-day{aspect-ratio:1;display:flex;align-items:center;justify-content:center;border:1px solid var(--border-light);cursor:pointer;transition:all .2s ease;font-weight:500;position:relative;}
    .calendar-day:hover{background:var(--yuli-light-blue);}
    .calendar-day.other-month{color:var(--text-muted);opacity:.4;}
    .calendar-day.selected{background:var(--yuli-primary);color:#fff;}
    .calendar-day.today{background:var(--yuli-accent-blue);color:#fff;}
    .calendar-day.today:not(.selected){background:var(--yuli-light-blue);color:var(--yuli-primary);font-weight:600;}
    /* ensure today stays dark when selected */
    .calendar-day.today.selected{background:var(--yuli-primary);color:#fff;}
    /* Past days (unclickable) */
    .calendar-day.disabled{opacity:.35;cursor:not-allowed;background:#f3f4f6;}
    .calendar-day.disabled:hover{background:#f3f4f6;}

    /* Time slots */
    .time-slots{display:grid;grid-template-columns:repeat(3,1fr);gap:.5rem;}
    .time-slot{padding:.75rem;border:1px solid var(--border-light);border-radius:8px;text-align:center;cursor:pointer;transition:all .2s ease;font-size:.9rem;font-weight:500;}
    .time-slot:hover{border-color:var(--yuli-primary);background:var(--yuli-light-blue);}
    .time-slot.selected{background:var(--yuli-primary);color:#fff;border-color:var(--yuli-primary);}
    .time-slot.unavailable{opacity:.4;cursor:not-allowed;background:#f3f4f6;}
    .time-slot.unavailable:hover{border-color:var(--border-light);background:#f3f4f6;}

    /* Duration */
    .duration-selector{display:flex;gap:1rem;}
    .duration-option{flex:1;padding:1rem;border:2px solid var(--border-light);border-radius:12px;text-align:center;cursor:pointer;transition:all .2s ease;}
    .duration-option:hover{border-color:var(--yuli-primary);background:var(--yuli-light-blue);}
    .duration-option.selected{border-color:var(--yuli-primary);background:var(--yuli-primary);color:#fff;}
    .duration-time{font-size:1.1rem;font-weight:600;margin-bottom:.25rem;}
    .duration-price{font-size:.9rem;opacity:.8;}

    /* Contact details */
    .contact-details{display:block;}
    .contact-method{display:flex;gap:.5rem;margin-top:1rem;}
    .contact-option{flex:1;padding:.5rem;border:1px solid var(--border-light);border-radius:8px;text-align:center;cursor:pointer;transition:all .2s ease;font-size:.9rem;}
    .contact-option:hover{border-color:var(--yuli-primary);background:var(--yuli-light-blue);}
    .contact-option.selected{background:var(--yuli-primary);color:#fff;border-color:var(--yuli-primary);}

    /* Summary */
    .booking-summary{background:var(--bg-blue-tint);border-radius:12px;padding:1.5rem;margin:1.5rem 0;}
    .summary-title{font-weight:600;margin-bottom:1rem;color:var(--text-dark);}
    .summary-item{display:flex;justify-content:space-between;margin-bottom:.5rem;font-size:.95rem;}
    .summary-label{color:var(--text-muted);}
    .summary-value{font-weight:500;color:var(--text-dark);}
    .total-price{border-top:1px solid var(--border-light);padding-top:.75rem;margin-top:.75rem;font-weight:600;font-size:1.1rem;}
    .submit-button{width:100%;background:var(--yuli-primary);color:#fff;border:none;padding:1rem;border-radius:12px;font-size:1.1rem;font-weight:600;cursor:pointer;transition:all .3s ease;margin-top:1rem;}
    .submit-button:hover{
  transform:translateY(-2px);
  box-shadow:var(--shadow-blue);
  background:var(--yuli-primary);
  opacity: 0.9;
}
    .submit-button:disabled{opacity:.6;cursor:not-allowed;transform:none;}
    .disclaimer{font-size:.85rem;color:var(--text-muted);text-align:center;margin-top:1rem;line-height:1.5;}

    /* Footer (matched to homepage) */
    footer{
      background:#212529;
      color:rgba(255,255,255,.86);
      padding:84px 0 40px;
    }
    footer .container{max-width:1200px;margin:0 auto;padding:0 20px;}
    .footer-grid{
      display:grid;
      grid-template-columns:1.4fr 1fr 1fr 1fr;
      gap:36px;
      margin:0 0 36px;
      padding:0;
      align-items:start;
    }
    .footer-brand{display:flex;flex-direction:column;}
    .footer-brand h3{margin:0 0 10px;font-size:1.6rem;color:#fff;}
    .footer-brand h3 span{color:#ff69b4;}
    .footer-contact{display:grid;gap:6px;margin-top:0;}
    .footer-contact a{color:rgba(255,255,255,.78);text-decoration:none;font-size:.98rem;transition:all .3s ease;}
    .footer-contact a:hover{color:#fff;text-decoration:underline;}
    .footer-social{display:flex;gap:14px;margin-top:12px;}
    .footer-social a{width:34px;height:34px;display:inline-flex;align-items:center;justify-content:center;color:rgba(255,255,255,.86);border:1px solid rgba(255,255,255,.2);border-radius:50%;transition:all .2s ease;text-decoration:none;}
    .footer-social a:hover{color:#fff;border-color:rgba(255,255,255,.36);transform:translateY(-1px);}
    .footer-heading{margin-bottom:12px;padding-bottom:8px;font-size:1.02rem;font-weight:600;position:relative;}
    .footer-heading::after{content:'';position:absolute;left:0;bottom:0;width:40px;height:2px;background:#ff69b4;}
    .footer-links{list-style:none;padding:0;margin:0;}
    .footer-links li{margin-bottom:10px;}
    .footer-links a{color:rgba(255,255,255,.7);text-decoration:none;transition:all .3s ease;font-size:.95rem;}
    .footer-links a:hover{color:#fff;padding-left:5px;}
    footer .footer-bottom{
      display:flex;justify-content:center;gap:24px;text-align:center;
      margin:30px auto 0;padding:24px 0 0;border-top:1px solid rgba(255,255,255,.1);max-width:100%;
    }
    .footer-bottom p{font-size:.92rem;margin:5px 0;color:rgba(255,255,255,.6);}

    /* Responsive */
    @media (max-width:900px){.footer-grid{grid-template-columns:1fr 1fr;row-gap:22px;}}
    @media (max-width:640px){
      .main-container{grid-template-columns:1fr;gap:2rem;padding:2rem 1rem;}
      .hero-content h1{font-size:2rem;}
      .booking-card{position:static;padding:1.5rem;}
      .time-slots{grid-template-columns:repeat(2,1fr);}
      .duration-selector{flex-direction:column;}
      .what-happens-next{padding:1.5rem;}
      .section-title{font-size:1.1rem;}
      .footer-grid{grid-template-columns:1fr;}
      .footer-brand{text-align:left;}
      .footer-section{text-align:center;}
      .footer-social{justify-content:center;}
    }
  </style>
</head>
<body>

  <!-- Header -->
  <header class="site-header">
    <div class="header-container">
      <a href="/" class="logo">Yuli<span>.</span></a>
      <a href="/pages/subjects/gcse-history.html?theme=neo" class="back-button"><i class="fas fa-arrow-left"></i> Back to History</a>
    </div>
  </header>

  <!-- Main Content -->
  <div class="main-container">
    <!-- Left Column -->
    <div class="hero-section">
      <div class="hero-content">
        <div class="subject-badge" id="subjectBadge">GCSE History</div>
        <h1>Book Your Session</h1>
        <p class="hero-description">
          Choose your preferred date and time for a personalised tutoring session.
          We'll confirm your booking and send you the session details via your preferred contact method.
        </p>

        <!-- What Happens Next -->
        <div class="what-happens-next">
          <h3 class="section-title"><i class="fas fa-route"></i> What Happens Next</h3>

          <div class="timeline-steps">
            <div class="timeline-step">
              <div class="timeline-icon"><i class="fas fa-bolt"></i></div>
              <div class="timeline-content">
                <div class="timeline-timing">Immediately</div>
                <div class="timeline-description">Booking confirmation email sent to your inbox</div>
              </div>
            </div>

            <div class="timeline-step">
              <div class="timeline-icon"><i class="fas fa-clock"></i></div>
              <div class="timeline-content">
                <div class="timeline-timing">Within 2 hours</div>
                <div class="timeline-description">Session link and preparation guide delivered</div>
              </div>
            </div>

            <div class="timeline-step">
              <div class="timeline-icon"><i class="fas fa-bell"></i></div>
              <div class="timeline-content">
                <div class="timeline-timing">24 hours before</div>
                <div class="timeline-description">Reminder email with session materials</div>
              </div>
            </div>

            <div class="timeline-step">
              <div class="timeline-icon"><i class="fas fa-video"></i></div>
              <div class="timeline-content">
                <div class="timeline-timing">Day of session</div>
                <div class="timeline-description">Join link active 10 minutes early</div>
              </div>
            </div>

            <div class="timeline-step">
              <div class="timeline-icon"><i class="fas fa-chart-line"></i></div>
              <div class="timeline-content">
                <div class="timeline-timing">After session</div>
                <div class="timeline-description">Progress summary and next steps sent to parents</div>
              </div>
            </div>
          </div>

          <div class="info-box">
            <div class="info-box-title"><i class="fas fa-desktop"></i> Technical Setup</div>
            <div class="info-item"><span class="info-item-label">Platform:</span><span class="info-item-value">Microsoft Teams (link provided after booking)</span></div>
            <div class="info-item"><span class="info-item-label">You'll need:</span><span class="info-item-value">Stable internet, headphones, pen & paper</span></div>
            <div class="info-item"><span class="info-item-label">Test connection:</span><span class="info-item-value">5-minute setup check available</span></div>
            <div class="info-item"><span class="info-item-label">Support:</span><span class="info-item-value">Phone number provided for technical issues</span></div>
          </div>

          <div class="info-box">
            <div class="info-box-title"><i class="fas fa-play-circle"></i> First Session Structure</div>
            <div class="session-structure-item"><span class="session-timing">Opening (10 mins):</span><span class="session-description">Goals discussion and level assessment</span></div>
            <div class="session-structure-item"><span class="session-timing">Main session (35-45 mins):</span><span class="session-description">Diagnostic teaching and practice</span></div>
            <div class="session-structure-item"><span class="session-timing">Closing (5-10 mins):</span><span class="session-description">Feedback and planning next steps</span></div>
            <div class="session-structure-item"><span class="session-timing">Parent update:</span><span class="session-description">Email summary within 24 hours</span></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Right Column -->
    <div class="booking-card">
      <div class="booking-steps">
        <!-- Step 1 -->
        <div class="step" id="step1">
          <div class="step-header" onclick="openStep(1)">
            <div class="step-header-left">
              <div class="step-number">1</div>
              <div>
                <div class="step-title">Course Details</div>
                <div class="step-summary" id="step1Summary" style="display:none;"></div>
              </div>
            </div>
            <div class="step-icon"><i class="fas fa-chevron-down"></i></div>
          </div>

          <div class="step-content" id="step1Content">
            <div class="form-group">
              <label class="form-label" for="examBoard">Exam Board <span class="required">*</span></label>
              <select id="examBoard" class="form-select" required>
                <option value="">Select exam board...</option>
                <option value="AQA">AQA</option>
                <option value="Edexcel">Edexcel (Pearson)</option>
                <option value="OCR">OCR</option>
                <option value="WJEC">WJEC</option>
                <option value="CIE">CIE (Cambridge International)</option>
                <option value="Other">Other</option>
                <option value="Not sure">Not sure</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="currentGrade">Current Grade <span class="required">*</span></label>
              <select id="currentGrade" class="form-select" required>
                <option value="">Select current grade...</option>
                <option value="Grade 3">Grade 3</option>
                <option value="Grade 4">Grade 4</option>
                <option value="Grade 5">Grade 5</option>
                <option value="Grade 6">Grade 6</option>
                <option value="Grade 7">Grade 7</option>
                <option value="Grade 8">Grade 8</option>
                <option value="Grade 9">Grade 9</option>
                <option value="Not sure">Not sure - we can assess this</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="targetGrade">Target Grade <span class="required">*</span></label>
              <select id="targetGrade" class="form-select" required>
                <option value="">Select target grade...</option>
                <option value="Grade 4">Grade 4 (Standard Pass)</option>
                <option value="Grade 5">Grade 5 (Strong Pass)</option>
                <option value="Grade 6">Grade 6</option>
                <option value="Grade 7">Grade 7</option>
                <option value="Grade 8">Grade 8</option>
                <option value="Grade 9">Grade 9</option>
                <option value="Not sure">Not sure</option>
              </select>
            </div>

            <div class="form-group">
              <label class="form-label" for="specificAreas">Specific Areas to Focus On (Optional)</label>
              <textarea id="specificAreas" class="form-input" rows="3" placeholder="e.g., Algebra, Quadratic equations, Trigonometry..."></textarea>
            </div>

            <button class="continue-button" id="continueToDateTime" disabled>
              <i class="fas fa-arrow-right"></i> Continue to Date & Time
            </button>
          </div>
        </div>

        <!-- Step 2 -->
        <div class="step" id="step2">
          <div class="step-header" onclick="openStep(2)">
            <div class="step-header-left">
              <div class="step-number">2</div>
              <div>
                <div class="step-title">Select Date & Time</div>
                <div class="step-summary" id="step2Summary" style="display:none;"></div>
              </div>
            </div>
            <div class="step-icon"><i class="fas fa-chevron-down"></i></div>
          </div>

          <div class="step-content" id="step2Content" style="display:none;">
            <div class="calendar-container">
              <div class="calendar-header">
                <button class="calendar-nav" id="prevMonth"><i class="fas fa-chevron-left"></i></button>
                <div class="calendar-month" id="currentMonth"></div>
                <button class="calendar-nav" id="nextMonth"><i class="fas fa-chevron-right"></i></button>
              </div>
              <div class="calendar-grid" id="calendarGrid"></div>
            </div>

            <div class="time-slots" id="timeSlots" style="display:none;"></div>
          </div>
        </div>

        <!-- Step 3 -->
        <div class="step" id="step3">
          <div class="step-header" onclick="openStep(3)">
            <div class="step-header-left">
              <div class="step-number">3</div>
              <div>
                <div class="step-title">Session Duration</div>
                <div class="step-summary" id="step3Summary" style="display:none;"></div>
              </div>
            </div>
            <div class="step-icon"><i class="fas fa-chevron-down"></i></div>
          </div>

          <div class="step-content" id="step3Content" style="display:none;">
            <!-- Session Type Selection -->
            <div class="form-group" id="sessionTypeSection">
              <label class="form-label">Session Type</label>
              <div class="session-type-selector" style="display: flex; gap: 1rem; margin-bottom: 1.5rem;">
                <div class="session-type-option" data-type="individual" style="flex: 1; padding: 1.25rem 1rem; border: 2px solid var(--border-light); border-radius: 12px; text-align: center; cursor: pointer; display: flex; flex-direction: column; justify-content: center; min-height: 80px;">
                  <div style="font-weight: 600; margin-bottom: 4px;">Individual</div>
                  <div style="font-size: 0.9rem; color: var(--text-muted);">One-on-one session</div>
                </div>
                <div class="session-type-option" data-type="group" style="flex: 1; padding: 1.25rem 1rem; border: 2px solid var(--border-light); border-radius: 12px; text-align: center; cursor: pointer; display: flex; flex-direction: column; justify-content: center; min-height: 80px;">
                  <div style="font-weight: 600; margin-bottom: 4px;">Group Session</div>
                  <div style="font-size: 0.9rem; color: var(--text-muted);">2-4 students (£12/hour each)</div>
                </div> 
              </div>
            </div>

            <!-- Duration Selection (appears after session type is selected) -->
            <div class="form-group" id="durationSection" style="display: none;">
              <label class="form-label">Session Duration</label>
              <div class="duration-selector" id="durationSelector">
                <div class="duration-option" data-duration="60" data-price="20">
                  <div class="duration-time">1 Hour</div>
                  <div class="duration-price">£20</div>
                </div>
                <div class="duration-option" data-duration="90" data-price="30" id="duration90">
                  <div class="duration-time">90 Minutes</div>
                  <div class="duration-price">£30</div>
                </div>
              </div>
            </div>
            
            <!-- Group Session Info -->
            <div id="groupSessionInfo" style="display: none; background: var(--bg-blue-tint); border-radius: 12px; padding: 1rem; margin-top: 1rem;">
              <div style="font-weight: 600; color: var(--yuli-primary); margin-bottom: 0.5rem;">
                <i class="fas fa-users"></i> Group Session Information
              </div>
              <div style="font-size: 0.9rem; color: var(--text-muted); line-height: 1.5;">
                We need 2-4 students to run a group session. If we can't form a group within 48 hours, 
                we'll contact you to either:
                <ul style="margin: 0.5rem 0; padding-left: 1.5rem;">
                  <li>Schedule an individual session at the same time</li>
                  <li>Join you with another available group session</li>
                  <li>Provide a full refund</li>
                </ul>
              </div>
            </div>

            <!-- Coming Soon Style for 90 min group sessions -->
            <style>
              .duration-option.coming-soon {
                opacity: 0.5;
                cursor: not-allowed;
                background: #f8f9fa !important;
                border-color: #dee2e6 !important;
              }
              .duration-option.coming-soon:hover {
                background: #f8f9fa !important;
                border-color: #dee2e6 !important;
              }
              .duration-option.coming-soon .duration-price {
                color: #6c757d;
              }
            </style>
          </div>
        </div>

        <!-- Step 4 -->
        <div class="step" id="step4">
          <div class="step-header" onclick="openStep(4)">
            <div class="step-header-left">
              <div class="step-number">4</div>
              <div>
                <div class="step-title">Contact Details</div>
                <div class="step-summary" id="step4Summary" style="display:none;"></div>
              </div>
            </div>
            <div class="step-icon"><i class="fas fa-chevron-down"></i></div>
          </div>

          <div class="step-content" id="step4Content" style="display:none;">
            <div class="contact-details" id="contactDetails">
              <div class="form-group">
                <label class="form-label" for="email">Email Address</label>
                <input type="email" id="email" class="form-input" placeholder="your@email.com">
              </div>

              <div class="form-group">
                <label class="form-label" for="phone">Phone Number</label>
                <input type="tel" id="phone" class="form-input" placeholder="+44 7700 900000" required>
              </div>

              <div class="form-group">
                <label class="form-label">Preferred Contact Method</label>
                <div class="contact-method">
                  <div class="contact-option selected" data-method="email"><i class="fas fa-envelope"></i> Email</div>
                  <div class="contact-option" data-method="phone"><i class="fas fa-phone"></i> Phone</div>
                  <div class="contact-option" data-method="sms"><i class="fas fa-sms"></i> SMS</div>
                </div>
              </div>

              <div class="form-group">
                <label class="form-label" for="notes">Additional Notes (Optional)</label>
                <textarea id="notes" class="form-input" rows="3" placeholder="Any specific topics you'd like to focus on or questions you have..."></textarea>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Summary -->
      <div class="booking-summary" id="bookingSummary" style="display:none;">
        <div class="summary-title">Booking Summary</div>
        <div class="summary-item"><span class="summary-label">Subject:</span><span class="summary-value" id="summarySubject">GCSE History</span></div>
        <div class="summary-item"><span class="summary-label">Exam Board:</span><span class="summary-value" id="summaryExamBoard">-</span></div>
        <div class="summary-item"><span class="summary-label">Current → Target:</span><span class="summary-value" id="summaryGrades">-</span></div>
        <div class="summary-item"><span class="summary-label">Date:</span><span class="summary-value" id="summaryDate">-</span></div>
        <div class="summary-item"><span class="summary-label">Time:</span><span class="summary-value" id="summaryTime">-</span></div>
        <div class="summary-item"><span class="summary-label">Duration:</span><span class="summary-value" id="summaryDuration">-</span></div>
        <div class="summary-item total-price"><span class="summary-label">Total:</span><span class="summary-value" id="summaryTotal">£0</span></div>
      </div>

      <button class="submit-button" id="submitBooking" style="display:none;">
        <i class="fas fa-calendar-check"></i> Confirm Booking
      </button>

      <p class="disclaimer">
        We may contact you to adjust the time if there are any scheduling conflicts.
        You'll receive a confirmation email with session details within 24 hours.
      </p>
    </div>
  </div>

  <script>
    // Booking form state
    let bookingData={
      subject:'GCSE History',
      examBoard:null,currentGrade:null,targetGrade:null,specificAreas:null,
      date:null,time:null,duration:null,price:null,contactMethod:'email'
    };
    let currentDate=new Date();let selectedDate=null;let currentOpenStep=1;

    // Discount system variables
let userDiscountStatus = null;
let discountedRates = {
  gcse: { individual: 12, group: 8 },
  alevel: { individual: 18, group: 12 }
};
let standardRates = {
  gcse: { individual: 20, group: 12 },
  alevel: { individual: 35, group: 20 }
};

// Check if user has approved discount
async function checkUserDiscountStatus() {
  if (!firebase.auth().currentUser) {
    return null;
  }

  try {
    const db = firebase.firestore();
    const userDoc = await db.collection('users').doc(firebase.auth().currentUser.uid).get();
    
    if (userDoc.exists) {
      const userData = userDoc.data();
      userDiscountStatus = userData.discountStatus;
      
      if (userDiscountStatus === 'approved') {
  updatePricingDisplay();
} else {
  showDiscountInfo();
}
    }
  } catch (error) {
    console.error('Error checking discount status:', error);
  }
}

// Update pricing to show discounts subtly
function updateDiscountPricing() {
  // This will be called when session types are selected
  // We'll integrate the discount display into the existing pricing logic
}
// Update pricing throughout the booking flow
function updatePricingDisplay() {
  if (userDiscountStatus !== 'approved') return;
  
  // Update duration selector prices
  updateDurationPrices();
}

// Show discount info for non-eligible users
function showDiscountInfo() {
  if (userDiscountStatus === 'approved') return; // Don't show if already approved
  
  const bookingCard = document.querySelector('.booking-card');
  if (!bookingCard) return;
  
  const infoDiv = document.createElement('div');
  infoDiv.className = 'discount-info';
  infoDiv.innerHTML = `
    <div style="
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      color: #475569;
      padding: 1rem 1.5rem;
      border-radius: 12px;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.75rem;
    ">
      <i class="fas fa-info-circle" style="color: #4361EE;"></i>
      <div style="flex: 1;">
        <div style="font-size: 0.9rem;">
          Financial support available - discounted rates for families receiving benefits or free school meals. 
          <a href="/profile.html" style="color: #4361EE; text-decoration: none; font-weight: 500;">Apply in your profile</a>
        </div>
      </div>
    </div>
  `;
  
  bookingCard.insertBefore(infoDiv, bookingCard.firstChild);
}

function updateDurationPrices() {
  const subject = bookingData.subject.toLowerCase();
  const isGCSE = subject.includes('gcse');
  const rates = isGCSE ? discountedRates.gcse : discountedRates.alevel;
  
  // Update individual session prices
  const duration60 = document.querySelector('[data-duration="60"]');
  const duration90 = document.querySelector('[data-duration="90"]');
  
  if (duration60) {
    const price60 = rates.individual;
    const price90 = Math.round(price60 * 1.5);
    
    duration60.dataset.price = price60;
    duration60.querySelector('.duration-price').innerHTML = `<span style="text-decoration: line-through; color: #9ca3af; font-size: 0.85em;">£${standardRates.gcse.individual}</span> £${price60}`;
    
    if (duration90) {
      duration90.dataset.price = price90;
      duration90.querySelector('.duration-price').innerHTML = `<span style="text-decoration: line-through; color: #9ca3af; font-size: 0.85em;">£${Math.round(standardRates.gcse.individual * 1.5)}</span> £${price90}`;
    }
  }
}

    // --- Step 1 helpers ---
    function checkStep1Completion() {
      const examBoard = document.getElementById('examBoard').value;
      const currentGrade = document.getElementById('currentGrade').value;
      const targetGrade = document.getElementById('targetGrade').value;
      const continueButton = document.getElementById('continueToDateTime');

      if (examBoard && currentGrade && targetGrade) {
        continueButton.disabled = false;
        bookingData.examBoard = examBoard;
        bookingData.currentGrade = currentGrade;
        bookingData.targetGrade = targetGrade;
      } else {
        continueButton.disabled = true;
      }
    }

    // Extract grade number (e.g. "Grade 5 (Strong Pass)" -> 5)
    function extractGradeNumber(str){
      if(!str) return null;
      const m = str.match(/Grade\s*(\d+)/i);
      return m ? parseInt(m[1]) : null;
    }

    // Only allow target >= current
    function updateTargetGradeOptions(){
      const curSel = document.getElementById('currentGrade');
      const tgtSel = document.getElementById('targetGrade');
      const curVal = curSel.value;

      // Show everything if not selected / not sure
      if(!curVal || curVal === 'Not sure'){
        Array.from(tgtSel.options).forEach(o => o.style.display = '');
        return;
      }

      const curNum = extractGradeNumber(curVal);
      if(curNum === null){
        Array.from(tgtSel.options).forEach(o => o.style.display = '');
        return;
      }

      Array.from(tgtSel.options).forEach(o=>{
        const v = o.value;
        if(v === '' || v === 'Not sure'){ o.style.display=''; return; }
        const tNum = extractGradeNumber(v);
        o.style.display = (tNum !== null && tNum >= curNum) ? '' : 'none';
      });

      // If current selection hidden, reset it
      const sel = tgtSel.options[tgtSel.selectedIndex];
      if(sel && sel.style.display === 'none'){
        tgtSel.value = '';
        checkStep1Completion();
      }
    }

    // Prefill user's email if available (Firebase, storage, or URL ?email=)
    function prefillUserEmail(){
      const emailInput = document.getElementById('email');
      let found = null;

      // 1) Firebase Auth (if present on page)
      try{
        if (window.firebase && firebase.auth){
          const user = firebase.auth().currentUser;
          if (user && user.email) found = user.email;
          else {
            firebase.auth().onAuthStateChanged(u=>{
              if(u && u.email && !emailInput.dataset.locked){
                emailInput.value = u.email;
                emailInput.readOnly = true;
                emailInput.dataset.locked = '1';
              }
            });
          }
        }
      }catch(e){/* ignore */ }

      // 2) local/session storage common keys
      if(!found){
        const keys = ['yuli.email','userEmail','email','auth.email','profile.email'];
        for(const k of keys){
          found = localStorage.getItem(k) || sessionStorage.getItem(k);
          if(found) break;
        }
      }

      // 3) URL query ?email=
      if(!found){
        const params = new URLSearchParams(location.search);
        const q = params.get('email');
        if(q) found = q;
      }

      if(found){
        emailInput.value = found;
        emailInput.readOnly = true;
        emailInput.dataset.locked = '1';
      }else{
        // allow user to type if we don't know it
        emailInput.value = '';
        emailInput.placeholder = 'your@email.com';
        emailInput.readOnly = false;
      }
    }

    // --- DOM Ready ---
    document.addEventListener('DOMContentLoaded', function() {
      // Subject from badge
      const subjectBadge = document.getElementById('subjectBadge');
      if (subjectBadge) bookingData.subject = subjectBadge.textContent.trim();

      // Step 1 field listeners
      document.getElementById('examBoard').addEventListener('change', checkStep1Completion);
      document.getElementById('currentGrade').addEventListener('change', () => {
        updateTargetGradeOptions();
        checkStep1Completion();
      });
      document.getElementById('targetGrade').addEventListener('change', checkStep1Completion);
      updateTargetGradeOptions();

      // Calendar navigation
      document.getElementById('prevMonth').addEventListener('click', function() {
        currentDate.setMonth(currentDate.getMonth() - 1);
        updateCalendarDisplay();
      });
      document.getElementById('nextMonth').addEventListener('click', function() {
        currentDate.setMonth(currentDate.getMonth() + 1);
        updateCalendarDisplay();
      });

      // Continue to Step 2
      document.getElementById('continueToDateTime').addEventListener('click', function() {
        if (this.disabled) return;

        document.querySelector('#step1 .step-header').classList.add('completed');
        document.getElementById('step1Content').style.display = 'none';

        const s = document.getElementById('step1Summary');
        s.textContent = `${bookingData.examBoard} • ${bookingData.currentGrade} → ${bookingData.targetGrade}`;
        s.style.display = 'block';

        currentOpenStep = 2;
        document.getElementById('step2Content').style.display = 'block';
        updateCalendarDisplay();
        showTimeSlots();
        updateSummary();
      });

      // Prefill email
      prefillUserEmail();

      updateCalendarDisplay();
    });

    // --- Step open/close helpers ---
    function openStep(stepNumber){
      if(stepNumber<currentOpenStep||(stepNumber===currentOpenStep&&isStepCompleted(stepNumber))){reopenStep(stepNumber);return;}
      if(stepNumber>currentOpenStep&&!isStepCompleted(currentOpenStep)){return;}
    }
    function isStepCompleted(){return true;} // lightweight gating
    function reopenStep(stepNumber){
  for(let i=1;i<=4;i++){
    document.getElementById(`step${i}Content`).style.display='none';
    // Only hide summary and remove completed class for the step being reopened
    if(i === stepNumber) {
      document.getElementById(`step${i}Summary`).style.display='none';
      document.querySelector(`#step${i} .step-header`).classList.remove('completed');
    }
  }
  document.getElementById(`step${stepNumber}Content`).style.display='block';
  currentOpenStep = stepNumber;
  if(stepNumber === 2) showTimeSlots();
}

    // --- Time slots ---
    function showTimeSlots(){
      const c=document.getElementById('timeSlots');c.style.display='grid';c.innerHTML='';
      ['09:00','10:00','11:00','14:00','15:00','16:00','17:00','18:00'].forEach(time=>{
        const slot=document.createElement('div');slot.className='time-slot';slot.textContent=time;
        slot.addEventListener('click',()=>selectTimeSlot(time,slot));c.appendChild(slot);
      });
    }
    function selectTimeSlot(time,el){
      document.querySelectorAll('.time-slot.selected').forEach(x=>x.classList.remove('selected'));
      el.classList.add('selected');bookingData.time=time;

      document.querySelector('#step2 .step-header').classList.add('completed');
      document.getElementById('step2Content').style.display = 'none';

      const s2 = document.getElementById('step2Summary');
      s2.textContent = `${selectedDate ? selectedDate.toLocaleDateString('en-GB') : 'Today'} at ${time}`;
      s2.style.display = 'block';

      currentOpenStep=3;
      document.getElementById('step3Content').style.display='block';
      updateSummary();
    }
    // Session type selection
    document.addEventListener('click', e => {
      const typeOpt = e.target.closest('.session-type-option');
      if (!typeOpt) return;
      
      document.querySelectorAll('.session-type-option').forEach(el => {
        el.classList.remove('selected');
        el.style.background = '';
        el.style.color = '';
        el.style.borderColor = 'var(--border-light)';
      });
      
      typeOpt.classList.add('selected');
      typeOpt.style.background = 'var(--yuli-primary)';
      typeOpt.style.color = 'white';
      typeOpt.style.borderColor = 'var(--yuli-primary)';
      
      const isGroup = typeOpt.dataset.type === 'group';
      const duration90 = document.getElementById('duration90');
      
      // Show/hide group session info
      document.getElementById('groupSessionInfo').style.display = isGroup ? 'block' : 'none';
      
      // Show duration selection section
      document.getElementById('durationSection').style.display = 'block';

      // Make sure all text is readable when selected
const subText = typeOpt.querySelector('div:last-child');
if (subText) {
  subText.style.color = 'white';
  subText.style.opacity = '0.9';
}

// Reset unselected options to ensure their text is visible
document.querySelectorAll('.session-type-option:not(.selected)').forEach(opt => {
  const subTextUnselected = opt.querySelector('div:last-child');
  if (subTextUnselected) {
    subTextUnselected.style.color = 'var(--text-muted)';
    subTextUnselected.style.opacity = '1';
  }
});
      
      // Handle 90 minute option for group sessions
      if (isGroup) {
        duration90.classList.add('coming-soon');
        duration90.querySelector('.duration-price').innerHTML = 'Coming Soon';
        // Remove any existing click listeners
        duration90.style.pointerEvents = 'none';
      } else {
        duration90.classList.remove('coming-soon');
        duration90.querySelector('.duration-price').innerHTML = '£30';
        duration90.style.pointerEvents = 'auto';
      }
      
      // Update prices based on discount status
const subject = bookingData.subject.toLowerCase();
const isGCSE = subject.includes('gcse');
let rates;
if (userDiscountStatus === 'approved') {
  rates = isGCSE ? discountedRates.gcse : discountedRates.alevel;
} else {
  rates = isGCSE ? standardRates.gcse : standardRates.alevel;
}

// Update prices for individual sessions
if (!isGroup) {
  const price60 = rates.individual;
  const price90 = Math.round(rates.individual * 1.5);
  
  if (userDiscountStatus === 'approved') {
    document.querySelector('[data-duration="60"] .duration-price').innerHTML = `<div style="text-align: center;"><span style="text-decoration: line-through; color: #9ca3af; font-size: 0.8em; display: block;">£${standardRates.gcse.individual}</span><span style="color: #065f46; font-weight: 600;">£${price60}</span></div>`;
    document.querySelector('[data-duration="90"] .duration-price').innerHTML = `<div style="text-align: center;"><span style="text-decoration: line-through; color: #9ca3af; font-size: 0.8em; display: block;">£${Math.round(standardRates.gcse.individual * 1.5)}</span><span style="color: #065f46; font-weight: 600;">£${price90}</span></div>`;
  } else {
    document.querySelector('[data-duration="60"] .duration-price').textContent = `£${price60}`;
    document.querySelector('[data-duration="90"] .duration-price').textContent = `£${price90}`;
  }
  
  document.querySelector('[data-duration="60"]').dataset.price = price60;
  document.querySelector('[data-duration="90"]').dataset.price = price90;
} else {
  if (userDiscountStatus === 'approved') {
    document.querySelector('[data-duration="60"] .duration-price').innerHTML = `<div style="text-align: center;"><span style="text-decoration: line-through; color: #9ca3af; font-size: 0.8em; display: block;">£${standardRates.gcse.group} each</span><span style="color: #065f46; font-weight: 600;">£${rates.group} each</span></div>`;
  } else {
    document.querySelector('[data-duration="60"] .duration-price').textContent = `£${rates.group} each`;
  }
  document.querySelector('[data-duration="60"]').dataset.price = rates.group;
}
      
      bookingData.sessionType = typeOpt.dataset.type;
    });

    // --- Duration selection ---
    document.addEventListener('click', e => {
      const opt = e.target.closest('.duration-option');
      if (!opt || opt.classList.contains('coming-soon')) return;
      
      document.querySelectorAll('.duration-option.selected').forEach(el => el.classList.remove('selected'));
      opt.classList.add('selected');
      bookingData.duration = parseInt(opt.dataset.duration);
      bookingData.price = parseInt(opt.dataset.price);

      document.querySelector('#step3 .step-header').classList.add('completed');
      document.getElementById('step3Content').style.display = 'none';

      const s3 = document.getElementById('step3Summary');
      const sessionType = bookingData.sessionType === 'group' ? 'Group' : 'Individual';
      const duration = bookingData.duration === 60 ? '1 Hour' : '90 Minutes';
      const price = bookingData.sessionType === 'group' ? `£${bookingData.price} each` : `£${bookingData.price}`;
      s3.textContent = `${sessionType} • ${duration} • ${price}`;
      s3.style.display = 'block';

      currentOpenStep = 4;
      document.getElementById('step4Content').style.display = 'block';
      document.getElementById('bookingSummary').style.display = 'block';
      document.getElementById('submitBooking').style.display = 'block';
      updateSummary();
    });

    // --- Contact method selection ---
    document.addEventListener('click',e=>{
      const opt=e.target.closest('.contact-option'); if(!opt) return;
      document.querySelectorAll('.contact-option.selected').forEach(el=>el.classList.remove('selected'));
      opt.classList.add('selected'); bookingData.contactMethod=opt.dataset.method;
    });

    // --- Live calendar (past days disabled, today highlighted, Monday-start) ---
    function updateCalendarDisplay(){
      const monthLabel = document.getElementById('currentMonth');
      const grid       = document.getElementById('calendarGrid');
      if (!grid) return;

      const year  = currentDate.getFullYear();
      const month = currentDate.getMonth(); // 0-11
      const first = new Date(year, month, 1);
      const daysInMonth = new Date(year, month + 1, 0).getDate();

      if (monthLabel){
        monthLabel.textContent = currentDate.toLocaleString('en-GB', { month: 'long', year: 'numeric' });
      }

      grid.innerHTML = '';
      const dayHeaders = ['Mon','Tue','Wed','Thu','Fri','Sat','Sun'];
      dayHeaders.forEach(day => {
        const header = document.createElement('div');
        header.className = 'calendar-day-header';
        header.textContent = day;
        grid.appendChild(header);
      });

      // Monday-start offset
      let startIdx = (first.getDay() + 6) % 7;

      // Leading blanks
      for (let i = 0; i < startIdx; i++){
        const filler = document.createElement('div');
        filler.className = 'calendar-day other-month';
        filler.setAttribute('aria-hidden','true');
        grid.appendChild(filler);
      }

      const today = new Date(); today.setHours(0,0,0,0);

      // Real days
      for (let d = 1; d <= daysInMonth; d++){
        const dateObj = new Date(year, month, d);
        dateObj.setHours(0,0,0,0);

        const cell = document.createElement('div');
        cell.className = 'calendar-day';
        cell.textContent = d;

        if (dateObj.getTime() === today.getTime()){
          cell.classList.add('today');
        }

        const isPast = dateObj < today;
        if (isPast){
          cell.classList.add('disabled');
        } else {
          cell.addEventListener('click', () => {
            document.querySelectorAll('.calendar-day.selected').forEach(el => el.classList.remove('selected'));
            cell.classList.add('selected');
            selectedDate = new Date(year, month, d);
            bookingData.date = selectedDate;
            showTimeSlots();
          });
        }

        grid.appendChild(cell);
      }

      // Trailing blanks to complete last week
      const totalCells = startIdx + daysInMonth;
      const trailing = (7 - (totalCells % 7)) % 7;
      for (let i = 0; i < trailing; i++){
        const filler = document.createElement('div');
        filler.className = 'calendar-day other-month';
        filler.setAttribute('aria-hidden','true');
        grid.appendChild(filler);
      }
    }

    // --- Summary ---
    function updateSummary(){
      const g=id=>document.getElementById(id);
      g('summarySubject').textContent=bookingData.subject;
      g('summaryExamBoard').textContent=bookingData.examBoard||'-';
      if(bookingData.currentGrade&&bookingData.targetGrade){
        const cur=bookingData.currentGrade.replace('Grade ','');

        const tgt=bookingData.targetGrade.replace('Grade ','').split(' ')[0];
        g('summaryGrades').textContent=`${cur} → ${tgt}`;
      }
      if(bookingData.date){
        g('summaryDate').textContent=bookingData.date.toLocaleDateString('en-GB',{weekday:'long',day:'numeric',month:'long',year:'numeric'});
      }
      g('summaryTime').textContent=bookingData.time||'-';
      if(bookingData.duration){ g('summaryDuration').textContent=bookingData.duration===60?'1 Hour':'90 Minutes'; }
      g('summaryTotal').textContent=bookingData.price?`£${bookingData.price}`:'£0';
    }

    // Submit booking with Firebase
document.getElementById('submitBooking')?.addEventListener('click', async function(){
  const submitBtn = this;
  
  // Get contact details
  const email = document.getElementById('email').value.trim();
  const phone = document.getElementById('phone').value.trim();
  const notes = document.getElementById('notes').value.trim();
  const specificAreas = document.getElementById('specificAreas').value.trim();
  
  if (!email && !phone) {
    alert('Please provide either an email or phone number.');
    return;
  }
  
  // Show loading state
  submitBtn.disabled = true;
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving your booking...';
  
  try {
    // Add Firestore
    const script = document.createElement('script');
    script.src = 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js';
    document.head.appendChild(script);
    
    script.onload = async function() {
      const db = firebase.firestore();

// Create proper start timestamp
const [hours, minutes] = bookingData.time.split(':');
const startDateTime = new Date(bookingData.date);
startDateTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);

// Create booking document
const bookingDoc = {
  userId: firebase.auth().currentUser.uid,
  userEmail: email,
  contactEmail: email,
  contactPhone: phone || '',
  contactMethod: bookingData.contactMethod,
  subject: bookingData.subject,
  level: 'GCSE',
  examBoard: bookingData.examBoard,
  currentGrade: bookingData.currentGrade,
  targetGrade: bookingData.targetGrade,
  specificAreas: specificAreas || '',
  start: firebase.firestore.Timestamp.fromDate(startDateTime),
  duration: bookingData.duration,
  price: bookingData.price,
  notes: notes || '',
  status: 'confirmed',
  createdAt: firebase.firestore.FieldValue.serverTimestamp()
};
      
      // Save booking
      const bookingRef = await db.collection('bookings').add(bookingDoc);
      
      // Create admin notification
      await db.collection('adminNotifications').add({
        type: 'new_booking',
        title: 'New Booking Received',
        message: `New ${bookingDoc.subject} booking for ${bookingDoc.date} at ${bookingDoc.time}`,
        bookingId: bookingRef.id,
        createdAt: firebase.firestore.FieldValue.serverTimestamp(),
        read: false
      });
      
      // Success
      submitBtn.innerHTML = '<i class="fas fa-check"></i> Booking Confirmed!';
      submitBtn.style.background = '#16a34a';
      
      setTimeout(() => {
        alert(`Booking confirmed! You'll receive confirmation details at ${email}.`);
      }, 1000);
    };
    
  } catch (error) {
    console.error('Booking error:', error);
    submitBtn.disabled = false;
    submitBtn.innerHTML = '<i class="fas fa-calendar-check"></i> Confirm Booking';
    alert('Sorry, there was an error. Please try again.');
  }
});
  </script>

  <!-- Footer -->
  <footer>
    <div class="container">
      <div class="footer-grid">
        <div class="footer-brand">
          <h3>Yuli<span>.</span></h3>
          <div class="footer-contact">
            <a href="mailto:yuli.learning.uk@gmail.com" class="footer-email">yuli.learning.uk@gmail.com</a>
            <a href="tel:+447856210325" class="footer-phone">+447856210325</a>
          </div>
          <div class="footer-social" aria-label="Social media">
            <a href="https://www.linkedin.com/company/yuli-uk/?viewAsMember=true" target="_blank" rel="noopener" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
            <a href="https://www.instagram.com/yuli.learning/" target="_blank" rel="noopener" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
          </div>
        </div>

        <div class="footer-section">
          <h4 class="footer-heading"><a href="/about.html" style="text-decoration:none;color:inherit">Company</a></h4>
          <ul class="footer-links">
            <li><a href="/about.html">About Yuli</a></li>
            <li><a href="/site/careers.html">Careers</a></li>
          </ul>
        </div>

        <div class="footer-section">
          <h4 class="footer-heading"><a href="/site/legal/index.html" style="text-decoration:none;color:inherit">Legal</a></h4>
          <ul class="footer-links">
            <li><a href="/site/legal/terms.html">Terms & Conditions</a></li>
            <li><a href="/site/legal/privacy.html">Privacy Policy</a></li>
            <li><a href="/site/legal/cookies.html">Cookie Policy</a></li>
            <li><a href="/site/about/safeguarding.html">Safeguarding</a></li>
          </ul>
        </div>

        <div class="footer-section">
          <h4 class="footer-heading"><a href="/site/faqs.html" style="text-decoration:none;color:inherit">Support</a></h4>
          <ul class="footer-links">
            <li><a href="/site/contact.html">Contact Us</a></li>
            <li><a href="/site/faqs.html">FAQs</a></li>
            <li><a href="/site/legal/refunds.html">Refund Policy</a></li>
          </ul>
        </div>
      </div>

      <div class="footer-bottom">
        <p>&copy; 2024 Yuli. All rights reserved.</p>
        <p>Designed and built with ❤️ for quality education</p>
      </div>
    </div>
  </footer>
  <!-- Auto-fill Email Address with the signed-in Firebase user -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<script>
  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBy-UuSbSmrnVn7V2ub3w1MnalzhOitpu0",
    authDomain: "yuli-tutoring-platform.firebaseapp.com",
    projectId: "yuli-tutoring-platform",
    storageBucket: "yuli-tutoring-platform.firebasestorage.app",
    messagingSenderId: "1070288563693",
    appId: "1:1070288563693:web:eaffd3f0a599ef48198be4"
  };

  // Start Firebase once
  if (!window.firebase?.apps?.length) {
    firebase.initializeApp(firebaseConfig);
  }

  // Fill the Email box when the user is signed in
  document.addEventListener('DOMContentLoaded', function () {
    var emailBox = document.getElementById('email');
    if (!emailBox) return;

    // Optional: show a saved email immediately (nice UX)
    var cached = localStorage.getItem('yuli_user_email') || sessionStorage.getItem('yuli_user_email');
    if (cached) {
      emailBox.value = cached;
      emailBox.readOnly = true;
      emailBox.placeholder = '';
    }

    firebase.auth().onAuthStateChanged(async function (user) {
  if (user && user.email) {
    emailBox.value = user.email;
    emailBox.readOnly = true;
    emailBox.placeholder = '';
    localStorage.setItem('yuli_user_email', user.email);
    
    // Check discount status when user is authenticated
    await checkUserDiscountStatus();
  }
});
  });
</script>   
</body>
</html>
