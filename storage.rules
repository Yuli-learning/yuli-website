rules_version = '2';

// Craft rules based on data in your Firestore database
// allow write: if firestore.get(resource).data.some_field == true
service firebase.storage {
  match /b/{bucket}/o {
    // Users can upload and read their own avatar
    match /users/{userId}/avatar.jpg {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // Legacy path support for existing uploads
    match /profileImages/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // Private area for future chat attachments
    match /chat-uploads/{uid}/{fileName} {
      allow read, write: if request.auth != null
        && request.auth.uid == uid
        && request.resource.size < 10 * 1024 * 1024
        && (
          request.resource.contentType.matches('image/.*') ||
          request.resource.contentType.matches('application/pdf') ||
          request.resource.contentType.matches('video/.*') ||
          request.resource.contentType.matches('application/octet-stream')
        );
    }
  }
}
